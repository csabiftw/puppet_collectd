# generated by puppet
LoadPlugin postgresql

<Plugin postgresql>
    <Query custom_deadlocks>
        Statement "SELECT deadlocks as num_deadlocks \
            FROM pg_stat_database \
            WHERE datname = $1;"

        Param database

        <Result>
            Type "pg_xact"
            InstancePrefix "num_deadlocks"
            ValuesFrom "num_deadlocks"
        </Result>
    </Query>

    <%- @modules.each do |module_instance, module_config| -%>
    <Database "<%= module_instance %>">
    <%- module_config.each do |key,value| -%>
        <%- if key == 'queries' -%>

        <%- value.each do |queryname| -%>
        Query <%= queryname %>
        <%- end -%>
        <%- else -%>
        <%= key %> <%= value %>
        <%- end -%>
    <%- end -%>
    </Database>
    <%- end -%>
</Plugin>

